---
title: "plots"
author: "Naveed"
date: "2025-02-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r cars}
library(tidyverse)
library(dplyr)
library(gt)
```

## Load in the data

```{r}
life_expectancy_data <- read_csv("data/life_expectancy.csv")

calorie_data <- read_csv("data/calorie_supply.csv")

tobacco_data <- read_csv("data/tobacco_consumption.csv")

alcohol_data <- read_csv("data/alcohol_consumption.csv")  

vaping_data <- read_csv("data/vaping.csv")
```

## Data Wrangling

```{r}
life_expectancy_data <- life_expectancy_data %>% 
  select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex) %>%
  rename(ra = `Reference area`,
         life_expectancy = OBS_VALUE) %>% 
  filter(Sex == "Total")

calorie_data <- calorie_data %>% 
    select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex, Age) %>%
  rename(ra = `Reference area`,
         calories = OBS_VALUE) %>% 
  filter(Sex == "Total")

tobacco_data <- tobacco_data %>% 
  select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex, Age) %>%
  rename(ra = `Reference area`,
         tobacco = OBS_VALUE) %>% 
  filter(Sex == "Total",
         Age == "15 years or over")

alcohol_data <- alcohol_data %>% 
    select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex, Age) %>%
  rename(ra = `Reference area`,
         alcohol = OBS_VALUE) %>% 
  filter(Sex == "Total",
         Age == "15 years or over")

vaping_data <- vaping_data %>% 
    select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex, Age) %>%
  rename(ra = `Reference area`,
         vaping = OBS_VALUE) %>% 
  filter(Sex == "Total",
         Age == "15 years or over")
```

## Life expectancy plot  

```{r}
# Filter for the selected years
life_time_periods <- life_expectancy_data %>% 
   filter(TIME_PERIOD %in% c(2018, 2008, 1998))

# Ensure TIME_PERIOD is a factor for proper grouping
life_time_periods$TIME_PERIOD <- as.factor(life_time_periods$TIME_PERIOD)

# Create the bar plot with country on x-axis and 3 bars per country
ggplot(life_time_periods, aes(x = ra, y = life_expectancy, fill = TIME_PERIOD)) +
  geom_bar(stat = "identity", position = "dodge") +  # Dodge groups bars within each country
  geom_text(aes(label = life_expectancy), # add white label for age
            position = position_dodge(width = 0.9), 
            vjust = 1.5, 
            colour = "white", 
            size = 5, 
            fontface = "bold") +
  labs(title = "Life Expectancy Over Selected Years",
       x = "Country",
       y = "Life Expectancy",
       fill = "Year") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, color = "white"),  # Rotate x-axis labels & make them white
    axis.text.y = element_text(color = "white"),  # Make y-axis labels white
    plot.title = element_text(color = "#FFA500", face = "bold", size = 16),  # Title in bright orange
    panel.background = element_rect(fill = "black"),  # Black background
    plot.background = element_rect(fill = "black"),  # Black outer background
    legend.background = element_rect(fill = "black"),  # Black legend background
    legend.text = element_text(color = "white"),  # White legend text
    legend.title = element_text(color = "#FFA500", face = "bold")  # Orange legend title
  ) +
  scale_fill_manual(values = c("1998" = "#FF7F50",   # Orange-pink gradient
                               "2008" = "#8A2BE2",   # Bright purple
                               "2018" = "#FF69B4"))  # Hot pink
```


## Diet - Calories

```{r}
calorie_life_data <- full_join(life_expectancy_data, calorie_data) %>% 
  filter(TIME_PERIOD %in% c(2018, 2008, 1998))

calorie_life_data %>% 
<<<<<<< HEAD
  ggplot(aes(x = life_expectancy, y = calories, color = TIME_PERIOD)) + 
  geom_point() +
  facet_wrap(~ra) 
=======
  ggplot(aes(x = ra, y = calories, fill = factor(TIME_PERIOD))) + 
  geom_col(position = "dodge")
>>>>>>> 71b9dd4a9308f1aea551e5eb78d2bb63f11c00b7
```

## Tobacco

```{r}
tobacco_life_data <- full_join(life_expectancy_data, tobacco_data) %>% 
  filter(TIME_PERIOD %in% c(2018, 2008, 1998))

tobacco_life_data %>% 
  ggplot(aes(x = ra, y = tobacco, fill = factor(TIME_PERIOD))) + 
  geom_col(position = "dodge")

```

## Alcohol

```{r}
alcohol_life_data <- full_join(life_expectancy_data, alcohol_data) %>% 
  filter(TIME_PERIOD %in% c(2018, 2008, 1998))

alcohol_life_data %>% 
  ggplot(aes(x = ra, y = alcohol, fill = factor(TIME_PERIOD))) + 
  geom_col(position = "dodge")
```

## Vaping

```{r}
vaping_life_data <- full_join(life_expectancy_data, vaping_data)

vaping_life_data %>% 
  ggplot(aes(x = life_expectancy, y = vaping)) + 
  geom_point() +
  facet_wrap(~ra)
```

## Table

```{r}
total_data <- full_join(life_expectancy_data, calorie_data) %>% 
  full_join(., tobacco_data) %>%
  full_join(., alcohol_data) %>% 
  full_join(., vaping_data) %>% 
  group_by(ra) %>% 
  summarise(life_expectancy = mean(life_expectancy, na.rm = TRUE),
            calories = mean(calories, na.rm = TRUE),
            alcohol = mean(alcohol, na.rm = TRUE),
            tobacco = mean(tobacco, na.rm = TRUE),
            vaping = mean(vaping, na.rm = TRUE))

total_data %>%
  gt()
```

