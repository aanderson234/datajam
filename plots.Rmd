---
title: "plots"
author: "Naveed"
date: "2025-02-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(tidyverse)
library(dplyr)
library(gt)
```

## Load in the data

```{r}
life_expectancy_data <- read_csv("data/life_expectancy.csv")

calorie_data <- read_csv("data/calorie_supply.csv")

tobacco_data <- read_csv("data/tobacco_consumption.csv")

alcohol_data <- read_csv("data/alcohol_consumption.csv")  

vaping_data <- read_csv("data/vaping.csv")
```

## Data Wrangling

```{r}
life_expectancy_data <- life_expectancy_data %>% 
  select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex) %>%
  rename(ra = `Reference area`,
         life_expectancy = OBS_VALUE) %>% 
  filter(Sex == "Total")

calorie_data <- calorie_data %>% 
    select(Reference.area, OBS_VALUE, TIME_PERIOD, Sex, Age) %>%
  rename(ra = Reference.area,
         calories = OBS_VALUE) %>% 
  filter(Sex == "Total")

tobacco_data <- tobacco_data %>% 
  select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex, Age) %>%
  rename(ra = `Reference area`,
         tobacco = OBS_VALUE) %>% 
  filter(Sex == "Total",
         Age == "15 years or over")

alcohol_data <- alcohol_data %>% 
    select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex, Age) %>%
  rename(ra = `Reference area`,
         alcohol = OBS_VALUE) %>% 
  filter(Sex == "Total",
         Age == "15 years or over")

vaping_data <- vaping_data %>% 
    select(`Reference area`, OBS_VALUE, TIME_PERIOD, Sex, Age) %>%
  rename(ra = `Reference area`,
         vaping = OBS_VALUE) %>% 
  filter(Sex == "Total",
         Age == "15 years or over")
```

## Diet - Calories

```{r}
calorie_life_data <- full_join(life_expectancy_data, calorie_data) %>% 
  filter(TIME_PERIOD %in% c(2018, 2008, 1998))

calorie_life_data %>% 
  ggplot(aes(x = life_expectancy, y = calories, color = TIME_PERIOD)) + 
  geom_point() +
  facet_wrap(~ra)
```

## Tobacco

```{r}
tobacco_life_data <- full_join(life_expectancy_data, tobacco_data) %>% 
  filter(TIME_PERIOD %in% c(2018, 2008, 1998))

tobacco_life_data %>% 
  ggplot(aes(x = life_expectancy, y = tobacco, color = TIME_PERIOD)) + 
  geom_point() +
  facet_wrap(~ra)
```

## Alcohol

```{r}
alcohol_life_data <- full_join(life_expectancy_data, alcohol_data) %>% 
  filter(TIME_PERIOD %in% c(2018, 2008, 1998))

alcohol_life_data %>% 
  ggplot(aes(x = life_expectancy, y = alcohol, color = TIME_PERIOD)) + 
  geom_point() +
  facet_wrap(~ra)
```

## Vaping

```{r}
vaping_life_data <- full_join(life_expectancy_data, vaping_data)

vaping_life_data %>% 
  ggplot(aes(x = life_expectancy, y = vaping)) + 
  geom_point() +
  facet_wrap(~ra)
```

## Table

```{r}
total_data <- full_join(life_expectancy_data, calorie_data) %>% 
  full_join(., tobacco_data) %>%
  full_join(., alcohol_data) %>% 
  full_join(., vaping_data) %>% 
  group_by(ra) %>% 
  summarise(life_expectancy = mean(life_expectancy, na.rm = TRUE),
            calories = mean(calories, na.rm = TRUE),
            alcohol = mean(alcohol, na.rm = TRUE),
            tobacco = mean(tobacco, na.rm = TRUE),
            vaping = mean(vaping, na.rm = TRUE))

total_data %>%
  gt()
```

